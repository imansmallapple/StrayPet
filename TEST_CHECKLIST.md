# 测试清单 - 密码功能改进

## 📋 前端测试

### Forget 页面 (`/auth/forget`)

#### 页面加载测试

- [ ] 页面正确加载（有紫色梯度背景）
- [ ] 显示"重置密码"标题和副标题
- [ ] 显示 🐾 logo
- [ ] 页面有流畅的入场动画

#### 表单验证测试

- [ ] 邮箱字段接受有效邮箱格式
- [ ] 邮箱字段拒绝无效格式（如：abc 或 abc@）
- [ ] 验证码字段限制为 4 位数字
- [ ] 密码字段隐藏输入
- [ ] 确认密码字段隐藏输入

#### 验证码发送测试

- [ ] 未输入邮箱时"获取验证码"按钮被禁用
- [ ] 邮箱有效时按钮启用
- [ ] 点击按钮时显示"发送中…"
- [ ] 发送成功后显示绿色成功消息
- [ ] 倒计时从 60 秒开始
- [ ] 倒计时期间按钮被禁用
- [ ] 倒计时结束后按钮恢复启用

#### 密码重置测试

- [ ] 未填写所有字段时无法提交
- [ ] 两个密码不一致时显示错误 "✗ Passwords do not match"
- [ ] 密码少于 8 个字符时显示错误 "✗ Password must be at least 8 characters"
- [ ] 所有验证通过时可以提交
- [ ] 提交时按钮显示"重置中…"
- [ ] 重置成功后显示绿色消息并重定向到登录页
- [ ] 旧邮箱/验证码错误时显示详细错误消息

#### 链接测试

- [ ] "已记得密码"链接指向 `/auth/login`
- [ ] 点击链接能正确导航

---

### 个人资料页面密码修改

#### 按钮显示测试

- [ ] 登录用户的个人资料页面显示"修改密码"按钮
- [ ] 查看他人资料时不显示此按钮
- [ ] 按钮有正确的图标 (🔑)

#### 模态框测试

- [ ] 点击按钮打开修改密码模态框
- [ ] 模态框标题显示"修改密码"
- [ ] 模态框有 3 个密码字段
- [ ] 所有输入字段被禁用时按钮被禁用

#### 表单验证测试

- [ ] 任何字段为空时显示错误 "✗ Please fill in all password fields"
- [ ] 新密码与确认密码不匹配时显示错误
- [ ] 新密码少于 8 个字符时显示错误
- [ ] 新密码与旧密码相同时显示错误
- [ ] 所有验证通过时可以提交

#### 提交测试

- [ ] 提交时按钮显示"修改中…"
- [ ] 旧密码错误时显示 "✗ Old password incorrect!"
- [ ] 密码修改成功时显示成功提示
- [ ] 成功后模态框自动关闭
- [ ] 表单字段被清空

#### 错误处理测试

- [ ] 网络错误时显示友好的错误消息
- [ ] 后端返回的错误信息被正确显示
- [ ] 错误消息显示在模态框内部

---

## 🔧 后端测试

### change_password 端点测试

#### 认证测试

- [ ] 未认证用户调用返回 401 Unauthorized
- [ ] 认证用户可以调用此端点
- [ ] JWT Token 过期返回 401 Unauthorized

#### 权限测试

- [ ] 用户 A 无法修改用户 B 的密码（返回 403 Forbidden）
- [ ] 用户只能修改自己的密码

#### 密码验证测试

- [ ] 旧密码错误返回 400 Bad Request
- [ ] 旧密码正确允许继续
- [ ] 新密码被正确 hash 存储

#### 验证测试

- [ ] 所有必填字段缺失返回 400
- [ ] 新密码字段缺失返回 400
- [ ] old_password 字段缺失返回 400

#### 成功响应测试

- [ ] 密码修改成功返回 200 OK
- [ ] 返回消息 `{"msg": "Change password succeed!"}`
- [ ] 密码在数据库中被正确更新

#### 副作用测试

- [ ] 使用 SessionAuthentication 时，修改密码后用户自动登出
- [ ] 修改密码后需要使用新密码重新登录
- [ ] 旧密码无法再用于登录

---

## 🔐 安全测试

### SQL 注入防护

- [ ] 邮箱字段防止 SQL 注入
- [ ] 密码字段防止 SQL 注入
- [ ] 验证码字段防止 SQL 注入

### 密码安全

- [ ] 密码不以明文存储
- [ ] 密码使用 PBKDF2 等安全算法 hash
- [ ] 密码修改后无法用旧密码登录

### 权限隔离

- [ ] 用户 A 无法访问用户 B 的修改密码端点
- [ ] 管理员也需要知道旧密码才能修改用户密码

### 信息泄露防护

- [ ] 错误消息不泄露用户存在状态
- [ ] 错误消息不显示密码 hash

---

## 📱 UI/UX 测试

### Forget 页面 UI

- [ ] 在桌面设备上显示正确（最大宽度 420px）
- [ ] 在移动设备上响应式缩放
- [ ] 所有文字清晰易读
- [ ] 按钮大小合适，易于点击

### 密码修改模态框 UI

- [ ] 在桌面设备上居中显示
- [ ] 在移动设备上适配屏幕
- [ ] 密码字段使用 type="password" 隐藏输入
- [ ] 所有标签清晰可见

### 无障碍访问

- [ ] 所有输入字段有关联的 label
- [ ] 按钮有合适的 aria-label（可选）
- [ ] 错误消息清晰可读
- [ ] 颜色不是唯一的信息载体

---

## 🔄 集成测试

### 完整流程 - 忘记密码并重置

1. [ ] 在登录页面点击"忘记密码"链接
2. [ ] 进入 Forget 页面
3. [ ] 输入有效邮箱
4. [ ] 获取验证码（检查邮箱）
5. [ ] 输入验证码
6. [ ] 输入新密码
7. [ ] 点击重置
8. [ ] 成功后重定向到登录页
9. [ ] 使用新密码登录成功

### 完整流程 - 修改个人资料页面密码

1. [ ] 已登录用户进入个人资料页面
2. [ ] 点击"修改密码"按钮
3. [ ] 输入当前密码
4. [ ] 输入新密码
5. [ ] 确认新密码
6. [ ] 提交
7. [ ] 显示成功消息
8. [ ] 用户被提示需要重新登录
9. [ ] 使用新密码重新登录成功
10. [ ] 旧密码无法登录

---

## ✅ 回归测试

### 其他页面不受影响

- [ ] 注册页面仍能正常工作
- [ ] 登录页面仍能正常工作
- [ ] 重置密码页面 (`/auth/reset`) 仍能正常工作
- [ ] 个人资料其他功能仍能正常工作
- [ ] 上传头像功能仍能正常工作

### 样式一致性

- [ ] Forget 页面与 Register 页面样式一致
- [ ] 梯度背景相同
- [ ] 按钮样式一致
- [ ] 字体和间距一致

---

## 📊 测试结果总结

| 测试项          | 状态 | 备注   |
| --------------- | ---- | ------ |
| 前端编译        | ✅   | 无错误 |
| Forget 页面显示 | ⏳   | 待验证 |
| 密码验证逻辑    | ⏳   | 待验证 |
| 后端权限检查    | ⏳   | 待验证 |
| 密码修改功能    | ⏳   | 待验证 |
| 安全测试        | ⏳   | 待验证 |
| 移动设备测试    | ⏳   | 待验证 |
| 集成测试        | ⏳   | 待验证 |

---

## 🚀 部署前清单

- [ ] 所有测试通过
- [ ] 代码审查完成
- [ ] 文档更新完成
- [ ] 邮件服务配置正确
- [ ] 数据库迁移完成
- [ ] 静态文件收集完成
- [ ] 进行了备份
- [ ] 设置了监控和告警
- [ ] 通知了用户（如有必要）
- [ ] 准备了回滚方案

---

**测试负责人：** ******\_\_\_\_******  
**测试日期：** ******\_\_\_\_******  
**测试环境：** ******\_\_\_\_******
